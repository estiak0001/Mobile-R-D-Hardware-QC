@model WebAppEs.ViewModel.DailyMaxFaultAnalysis.MRNDHQC_TopFaultHeadVM
@inject IJsonHelper Json;

@{ ViewData["Title"] = "Create"; }

<style>
    .select2-results {
        color: black;
    }

    #select2-ddlModel-container, #select2-ddlCategory-container, #select2-ddlSubCategory-container {
        color: black;
    }

    .form-control {
        border-radius: 0;
        box-shadow: none;
        border-color: #d2d6de
    }

    .select2-hidden-accessible {
        border: 0 !important;
        clip: rect(0 0 0 0) !important;
        height: 1px !important;
        margin: -1px !important;
        overflow: hidden !important;
        padding: 0 !important;
        position: absolute !important;
        width: 1px !important
    }

    .form-control {
        display: block;
        width: 100%;
        height: 38px;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 4px;
        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
        -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
        -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
        transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s
    }

    .select2-container--default.select2-container--focus .select2-selection--multiple, .select2-container--default.select2-container--focus .select2-selection--single {
        border-color: #80bdff;
        height: 20px !important;
        width: 100% !important;
    }

    .select2-container--default .select2-selection--single {
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 4px;
        height: 20px !important;
        width: 100% !important;
    }

    .faultImage img {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        display: block;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        height: 160px;
    }

        .faultImage img:hover {
            box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);
        }
</style>
<div class="row">
    <div class="col-md-12">
        <div class="form-group">
            @Html.Raw(@ViewBag.Alert)
        </div>
    </div>
</div>
<div class="x_panel shadow bg-white rounded">
    <div class="container">
        <div style="border-bottom: 2px solid #E6E9ED; margin-bottom: 0px; padding: 0px 0px 0px!important; " class="x_title">
            <h2 style="color:black">Daily Maximum Fault Analysis</h2>
            <div class="clearfix"></div>
        </div>
        <div style="margin-top:0px" class="x_content">
            <br />
            <form class="form-label-left input_mask">
                <div class="row">
                    <div style="padding: 10px; border-radius: 8px; background-color: #fff;" class="col-md-12">
                        <input asp-for="Id" id="txtHiddenID" type="hidden">
                        <div class="row">
                            @if (Model.IsUpdate == "Update")
                            {
                                <div class="col-md-3">
                                    <label style="color: darkgreen; font-weight: bolder;" for="ddlAnalysisType">Analysis Type* :</label>
                                    <select disabled asp-for="AnalysisType" style="color: darkblue; font-weight: bolder;" id="ddlAnalysisType" class="form-control">
                                        <option value="">--Select Analysis Type--</option>
                                        <option value="In Line">In Line</option>
                                        <option value="Aging">Aging</option>
                                        <option value="OQC">OQC</option>
                                    </select>
                                    <span class="error">Please select Analysis Type!</span>
                                </div>
                            }
                            else
                            {
                                <div class="col-md-3">
                                    <label style="color: darkgreen; font-weight: bolder;" for="ddlAnalysisType">Analysis Type* :</label>
                                    <select asp-for="AnalysisType" style="color: darkblue; font-weight: bolder;" id="ddlAnalysisType" class="form-control">
                                        <option value="">--Select Analysis Type--</option>
                                        <option value="In Line">In Line</option>
                                        <option value="Aging">Aging</option>
                                        <option value="OQC">OQC</option>
                                    </select>
                                    <span class="error">Please select Analysis Type!</span>
                                </div>
                            }

                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-2 col-sm-2  form-group has-feedback">
                                <label>Date</label>

                                @*<input asp-for="Date" class="form-control form-control-sm">
            <span asp-validation-for="Date" class="text-danger"></span>*@
                                @if (Model.IsUpdate == "Update")
                                {
                                    <input id="txtDate" disabled asp-for="Date" class="form-control" /> }
                                else
                                {
                                    <input id="txtDate" asp-for="Date" class="form-control" />}
                                <span class="error">Please select date!</span>
                            </div>
                            @if (Model.IsUpdate == "Update")
                            {
                                <div class="col-md-2 col-sm-2  form-group has-feedback">
                                    <label>Model</label>
                                    <select disabled asp-for="PartsModelID" id="ddlModel" class="form-control">
                                        <option value="@Model.PartsModelID">--Select Model--</option>
                                        @foreach (var item in Model.PartsModelViewModel)
                                        {
                                            <option value="@item.ID">@item.Name</option>
                                        }
                                    </select>
                                    <span id="ddlmodelError" class="error">Please select model!</span>
                                </div>
                            }
                            else
                            {
                                <div class="col-md-2 col-sm-2  form-group has-feedback">
                                    <label>Model</label>
                                    <select asp-for="PartsModelID" id="ddlModel" class="form-control">
                                        <option value="@Model.PartsModelID">--Select Model--</option>
                                        @foreach (var item in Model.PartsModelViewModel)
                                        {
                                            <option value="@item.ID">@item.Name</option>
                                        }
                                    </select>
                                    <span id="ddlmodelError" class="error">Please select model!</span>
                                </div>
                            }

                            <div class="col-md-3">
                                <label for="ddlCategory">Category* :</label>
                                <select required id="ddlCategory" class="form-control">
                                    <option value="">--Select Category--</option>
                                    @foreach (var item in Model.MRNDQC_CategoryVM)
                                    {
                                        <option value="@item.Id">@item.CategoryName</option>
                                    }
                                </select>
                                <span class="error">Please select Category!</span>
                            </div>
                            <div class="col-md-2">
                                <label for="ddlFaultType">Fault Type* :</label>
                                <select id="ddlFaultType" class="form-control">
                                    <option value="">--Select Fault Type--</option>
                                    <option value="F">Functional</option>
                                    <option value="A">Aesthetic</option>
                                </select>
                                <span class="error">Please select Fault Type!</span>
                            </div>
                            <div class="col-md-3">
                                <label for="ddlSubCategory">Sub Category* :</label>
                                <select id="ddlSubCategory" class="form-control">
                                    <option value="">--Select Sub Category--</option>
                                </select>
                                <span class="error">Please select Sub Category</span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="wrapper shadow-lg bg-white rounded" style="padding: 0px; border-radius: 6px; " id="LoadedSortData">

            </div>
        </div>
    </div>
</div>


<div class="x_panel shadow bg-white rounded">
    <div class="container">
        <!-- start form for validation -->
        <form id="demo-form">
            <div style="">
                <div class="row">
                    <div class="col-md-10">
                        <div class="row">
                            @*<div class="col-md-3">
                                <label for="ddlAnalysisType">Analysis Type* :</label>
                                <select id="ddlAnalysisType" class="form-control">
                                    <option value="">--Select Analysis Type--</option>
                                    <option value="In Line">In Line</option>
                                    <option value="Aging">Aging</option>
                                    <option value="OQC">OQC</option>
                                </select>
                                <span class="error">Please select Analysis Type!</span>
                            </div>*@
                            <div style="" class="col-md-4 col-sm-4  form-group has-feedback">
                                <label style="">Reason</label>
                                <textarea style="height: 38px;" class="form-control" id="txtReason" placeholder="Enter Reason."></textarea>
                                <span class="error">Enter Reason!</span>
                            </div>
                            <div style="text-align: center;" class="col-md-2 col-sm-2  form-group has-feedback">
                                <label style=" text-align: center; font-weight: 900; color: #0c8120;">Sample</label>
                                <input style="" onclick="selectAllText(this.id)" type="number" class="form-control" id="txtSample" placeholder="Enter Sample Qty.">
                                <span class="error">Enter valid quantity!</span>
                            </div>
                            <div style="" class="col-md-6 col-sm-6  form-group has-feedback">
                                <label style="">Remarks</label>
                                <textarea style="height: 38px;" class="form-control" id="txtRemarks" placeholder="Enter Remarks."></textarea>
                                <span class="error">Enter Remarks!</span>
                            </div>
                        </div>
                        <div class="row">
                            <div style="" class="col-md-6 col-sm-6  form-group has-feedback">
                                <label style="">
                                    Probable Sol. And Re.
                                </label>
                                <textarea style="height: 38px;" class="form-control" id="txtSolutionAndRecommendation" placeholder="Enter Probable Sol. And Re."></textarea>
                                <span class="error">Enter Probable Sol. And Re.!</span>
                            </div>
                            <div style="" class="col-md-4 col-sm-4  form-group has-feedback">
                                <label style="">
                                    Select Image
                                </label>
                                <input style="color:indigo" type="file" class="upload form-control" id="f_UploadImage"><br />
                            </div>
                            <div class="col-md-2" style="text-align: center; margin-top: 15px;">
                                <input type="button" class="addbutton box-shadow" id="add" value="Add" />
                            </div>
                        </div>
                    </div>
                    <div id="" style="text-align:center" class="col-md-2">
                        <label>
                            Reset Image
                        </label>
                        <a class="btn btn-sm btn-danger" style="color:white; cursor:pointer" onclick="RefreshImage()" id="btnImageClear"><i class="fa fa-refresh"></i></a>
                        <a class="faultImage" target="_blank">
                            <div id="image-holder">
                                <img id="myUploadedImg" src="~/Banner/default.png" alt="Image" />
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div style="margin-top: 10px;" class="wrapper2" id="faultsItem">

            </div>
        </form>
    </div>
</div>
<div style="margin-top:10px">
    <div class="row">
        <div style="text-align:center" class="col-md-12">
            <button onclick="RedirectToPage()" class="btn btn-dark">Back To List</button>
            <button type="button" id="submit" class="btn btn-success">Submit</button>
        </div>
    </div>
</div>
<br />
<div style="height:200px">

</div>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script>
<link href="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/themes/blitzer/jquery-ui.css"
      rel="Stylesheet" type="text/css" />
<link href="~/vendors/toastr/toastr.css" rel="stylesheet" />

@section scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        $(document).ready(function () {
            /*alert("");*/


            //$("#ddlPartsModel").change(function () {
            //    alert($("#ddlPartsModel").val());
            //});


            $('#ddlModel, #ddlCategory, #ddlSubCategory').select2({});

            $('.numberFunctional').keyup(function () {
                //alert("0")
                var val1 = $("#txtMaterialFaultFun").val(),
                    val2 = $("#txtProductionFaultFun").val(), val3 = $("#txtSoftwareFaultFun").val();
                $("#txtTotalFunctional").text(Number(val1) + Number(val2) + Number(val3));
            });
            $('.numberAesthetic').keyup(function () {
                //alert("0")
                var val1 = $("#txtMaterialFaultAes").val(),
                    val2 = $("#txtProductionFaultAes").val();
                $("#textTotalAesthetic").text(Number(val1) + Number(val2));
            });
            //$('#btnImageClear').click(function () {
            //    //$('#f_UploadImage').val("");
            //    //$("#myUploadedImg").attr("src", "/Banner/default.png");
            //    alert("tap")
            //});


            $('#ddlCategory').on("change", function () {
                $('#ddlFaultType').val("");
                $('#ddlSubCategory').html('');
                var options = '';
                options += '<option value="">--Select Sub Category--</option>';
                $('#ddlSubCategory').append(options);
            });

            $('#ddlFaultType').on("change", function () {
                var category = $('#ddlCategory').val();
                var faultType = $('#ddlFaultType').val();
                if (category != "") {
                    var obj = { "CategoryID": category, "FaultType": faultType};
                    AjaxCall('@Url.Action("GetSubCategoryByCategoryID", "SubCategory")', obj, 'POST').done(function (response) {
                        if (response.length > 0) {
                            console.log(response);

                            $('#ddlSubCategory').html('');
                            var options = '';
                            options += '<option value="">--Select Sub Category--</option>';
                            for (var i = 0; i < response.length; i++) {
                                options += '<option value="' + response[i].id + '">' + response[i].subCategoryName + '</option>';
                            }
                            $('#ddlSubCategory').append(options);
                        }
                        else {
                            $('#ddlSubCategory').html('');
                            var options = '';
                            options += '<option value="">--Select Sub Category--</option>';
                            $('#ddlSubCategory').append(options);
                        }
                    }).fail(function (error) {
                        alert(error.StatusText);
                    });
                }
                else {
                    alert("Select Category First");
                    $('#ddlFaultType').val("");
                }
            });
        });
        
        function RefreshImage() {
            $('#f_UploadImage').val("");
            $("#myUploadedImg").attr("src", "/Banner/default.png");
        }
        function selectAllText(senderId) {
            document.getElementById(senderId).focus();
            document.getElementById(senderId).select();
        }
        function AjaxCall(url, data, type) {
            return $.ajax({
                url: url,
                type: type,
                data: data,
                //contentType: 'application/json'
            });
        }
    </script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="~/vendors/toastr/toastr.min.js"></script>
    <script>
        $(document).ready(function () {
            var IMGURL = "";
            $('#LoadedSortData').html('Select filter dropdown to preview...');
            var faultsItem = [];
            var LoadedSortData = [];
            var wwwrootpath = @Json.Serialize(Model.wwwrootpath);
            console.log(wwwrootpath);
            var LoadTopDataForEidit = @Json.Serialize(Model.MRNDHQC_TopFaultAnalysisList);
            console.log(LoadTopDataForEidit);
            if (LoadTopDataForEidit != null) {
                if (LoadTopDataForEidit.length != 0) {
                    faultsItem = [];
                    for (var h = 0; h < LoadTopDataForEidit.length; h++) {

                        console.log(LoadTopDataForEidit[h].analysisType);


                        faultsItem.push({
                            AnalysisType: LoadTopDataForEidit[h].analysisType,
                            PartsModelID: LoadTopDataForEidit[h].partsModelID,
                            Model: LoadTopDataForEidit[h].model,
                            CategoryID: LoadTopDataForEidit[h].categoryID,
                            Category: LoadTopDataForEidit[h].category,
                            SubCategoryID: LoadTopDataForEidit[h].subCategoryID,
                            SubCategory: LoadTopDataForEidit[h].subCategory,
                            Quantity: 0,
                            ImageUrl: LoadTopDataForEidit[h].imageUrl,
                            Reason: LoadTopDataForEidit[h].reason,
                            Sample: Number(LoadTopDataForEidit[h].sample),
                            Remarks: LoadTopDataForEidit[h].remarks,
                            ProblemSolAndRec: LoadTopDataForEidit[h].problemSolAndRec
                        });
                    }
                    console.log(faultsItem);
                    GeneratedItemsTable();
                }
            }


            //Add button click function
            $('#add').click(function () {
                var isValidItem = true;

                if ($('#ddlModel').val().trim() == "00000000-0000-0000-0000-000000000000") {
                    $('#ddlmodelError').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    var ModelID = $('#ddlModel').val().trim();
                    var ModelText = $("#ddlModel option:selected").text();
                    $('#ddlmodelError').css('visibility', 'hidden');
                }

                if ($('#txtDate').val().trim() == '') {
                    isValidItem = false;
                    $('#txtDate').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var dateVal = $('#txtDate').val().trim();
                    $('#txtDate').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlCategory').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlCategory').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var CategoryID = $('#ddlCategory').val().trim();
                    var CategoryText = $("#ddlCategory option:selected").text();
                    $('#ddlCategory').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#ddlFaultType').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlFaultType').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var FaultType = $('#ddlFaultType').val().trim();
                    var FaulttypeName = $("#ddlFaultType option:selected").text();
                    $('#ddlFaultType').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlSubCategory').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlSubCategory').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var SubCategoryID = $('#ddlSubCategory').val().trim();
                    var SubCategoryText = $("#ddlSubCategory option:selected").text();
                    $('#ddlSubCategory').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlAnalysisType').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlAnalysisType').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var Analysis = $('#ddlAnalysisType').val().trim();
                    var AnalysisText = $("#ddlAnalysisType option:selected").text();
                    $('#ddlAnalysisType').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#txtReason').val().trim() == '') {
                    isValidItem = false;
                    $('#txtReason').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var reason = $('#txtReason').val().trim();
                    $('#txtReason').siblings('span.error').css('visibility', 'hidden');
                }

                if (!($('#txtSample').val().trim() != '' && !isNaN($('#txtSample').val().trim()))) {
                    isValidItem = false;
                    $('#txtSample').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var sample = $('#txtSample').val().trim();
                    $('#txtSample').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#txtRemarks').val().trim() == '') {
                    isValidItem = false;
                    $('#txtRemarks').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var remarks = $('#txtRemarks').val().trim();
                    $('#txtRemarks').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#txtSolutionAndRecommendation').val().trim() == '') {
                    isValidItem = false;
                    $('#txtSolutionAndRecommendation').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var solutionAndRecommendation = $('#txtSolutionAndRecommendation').val().trim();
                    $('#txtSolutionAndRecommendation').siblings('span.error').css('visibility', 'hidden');
                }

                if (isValidItem) {
                    var isExixtsSubCategory = checkIfObjectExist(faultsItem, Analysis, CategoryText, CategoryID)
                    if (isExixtsSubCategory) {
                        var msg = "You already added this ( " + CategoryText + " ) category in " + Analysis + ", Please Remove to update!";
                        var title = "Error to Adding!"
                        showpop5(msg, title, "error");
                        //alert();
                    }
                    else {
                        var Date = DateFormat($('#txtDate').val());
                        var Model = $("#ddlModel option:selected").text();
                        var Cat = $("#ddlCategory option:selected").text();

                        var newFileName = Date + "_" + Analysis + "_" + Model + "_" + Cat + ".jpg";

                        sendFile(newFileName);
                        faultsItem.push({
                            AnalysisType: Analysis,
                            PartsModelID: ModelID,
                            Model: ModelText,
                            CategoryID: CategoryID,
                            Category: CategoryText,
                            SubCategoryID: SubCategoryID,
                            SubCategory: SubCategoryText,
                            Quantity: 0,
                            ImageUrl: IMGURL,
                            Reason: reason,
                            Sample: Number(sample),
                            Remarks: remarks,
                            ProblemSolAndRec: solutionAndRecommendation
                        });
                        console.log(faultsItem);
                        IMGURL = "";
                        $('#txtReason, #txtSample, #txtRemarks, #txtSolutionAndRecommendation, #f_UploadImage').val("");
                        $("#myUploadedImg").attr("src", "/Banner/default.png");
                    }
                }
                GeneratedItemsTable();
            });

            //Save button click function
            $('#submit').click(function () {
                //validation of save
                var isAllValid = true;
                if (faultsItem.length == 0) {
                    $('#faultsItem').html('<span style="color:red;">Please add details first!</span>');
                    isAllValid = false;
                }

                if ($('#txtDate').val().trim() == '') {
                    $('#txtDate').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    $('#txtDate').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlModel').val().trim() == "00000000-0000-0000-0000-000000000000") {
                    $('#ddlmodelError').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    $('#ddlmodelError').css('visibility', 'hidden');
                }

                if ($('#ddlCategory').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlCategory').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var CategoryID = $('#ddlCategory').val().trim();
                    var CategoryText = $("#ddlCategory option:selected").text();
                    $('#ddlCategory').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#ddlFaultType').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlFaultType').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var FaultType = $('#ddlFaultType').val().trim();
                    var FaulttypeName = $("#ddlFaultType option:selected").text();
                    $('#ddlFaultType').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#ddlSubCategory').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlSubCategory').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var SubCategoryID = $('#ddlSubCategory').val().trim();
                    var SubCategoryText = $("#ddlSubCategory option:selected").text();
                    $('#ddlSubCategory').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlAnalysisType').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlAnalysisType').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var Analysis = $('#ddlAnalysisType').val().trim();
                    var AnalysisText = $("#ddlAnalysisType option:selected").text();
                    $('#ddlAnalysisType').siblings('span.error').css('visibility', 'hidden');
                }

                //Save if valid
                if (isAllValid) {
                    var data = {
                        Date: $('#txtDate').val().trim(),
                        PartsModelID: $('#ddlModel').val().trim(),
                        AnalysisType: $('#ddlAnalysisType').val().trim(),
                        MRNDHQC_TopFaultAnalysisList: faultsItem
                    }
                    console.log(data);

                    $(this).val('Please wait...');

                    $.ajax({
                        url: '@Url.Action("TopFaultsDetailsAdd", "DailyMaxFaultAnalysis")',
                        type: "POST",
                        data: JSON.stringify(data),
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (d) {
                            showpop5("Data Save Successfully.", "Success!", "success")
                            window.location.href = '@Url.Action("Index", "DailyMaxFaultAnalysis")';
                        },
                        error: function () {
                            //alert('Error. Please try again.');
                            showpop5("Something went wrong. Please try again.", "Error!", "error")
                        }
                    });
                }
            });

            $('#ddlAnalysisType').on('change', function () {

                $('#ddlModel').val("00000000-0000-0000-0000-000000000000").change();
                $('#ddlCategory').val("").change();
                faultsItem = [];
                GeneratedItemsTable();
            });
            $('#ddlCategory, #ddlFaultType, #ddlSubCategory').on('change', function () {

                if ($('#ddlAnalysisType').val().trim() == '') {
                    alert("Please Select Analysis Type First!");
                    //Clear();
                }
                else {
                    DropDownChangeData();
                }
            });

            $('#txtDate').on('change', function () {

                if ($('#ddlAnalysisType').val().trim() == '') {
                    alert("Please Select Analysis Type First!");
                    //Clear();
                }
                else {
                    DropDownChangeData2();
                }
            });

            $('#ddlModel').on('change', function () {

                if ($('#ddlAnalysisType').val().trim() == '') {
                    alert("Please Select Analysis Type First!");
                    //Clear();
                }
                else {
                    DropDownChangeData2();
                }
            });

            $("#f_UploadImage").on('change', function () {
                var isValidItem = true;
                if ($('#ddlModel').val().trim() == "00000000-0000-0000-0000-000000000000") {
                    $('#ddlmodelError').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    var ModelID = $('#ddlModel').val().trim();
                    var ModelText = $("#ddlModel option:selected").text();
                    $('#ddlmodelError').css('visibility', 'hidden');
                }

                if ($('#txtDate').val().trim() == '') {
                    isValidItem = false;
                    $('#txtDate').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var dateVal = $('#txtDate').val().trim();
                    $('#txtDate').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#ddlCategory').val().trim() == '') {
                    isValidItem = false;
                    $('#ddlCategory').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    var CategoryID = $('#ddlCategory').val().trim();
                    var CategoryText = $("#ddlCategory option:selected").text();
                    $('#ddlCategory').siblings('span.error').css('visibility', 'hidden');
                }

                if (isValidItem) {
                    var MAX_FILE_SIZE = 10 * 1024 * 1024;
                    var fileUpload = $("#f_UploadImage").get(0);
                    var files = fileUpload.files;
                    var validExtensions = ['jpg', 'png', 'JPG', 'PNG']; //array of valid extensions
                    var fileName = files[0].name;
                    var fileNameExt = fileName.substr(fileName.lastIndexOf('.') + 1);
                    if ($.inArray(fileNameExt, validExtensions) == -1) {
                        alert("Invalid file type! Please Select only JPG file.");
                        $("#f_UploadImage").val("");
                        return false;
                    }
                    else if (files[0].size > MAX_FILE_SIZE) {
                        alert('File must not exceed 10 MB!');
                        $("#f_UploadImage").val("");
                        return false;
                    }
                    else {
                        if (typeof (FileReader) != "undefined") {

                            var image_holder = $("#image-holder");
                            image_holder.empty();
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                $("<img />", {
                                    "src": e.target.result,
                                    "class": "thumb-image",
                                    "id": "myUploadedImg"
                                }).appendTo(image_holder);
                            }
                            image_holder.show();
                            reader.readAsDataURL($(this)[0].files[0]);
                        } else {
                            alert("This browser does not support FileReader.");
                        }
                    }
                }
                else {
                    $('#f_UploadImage').val("");
                }
            });


            function DropDownChangeData() {
                var date = null;
                var ModelID = null;
                var categoryID = null;
                var faulttype = null;
                var SubCategoryID = null;

                if ($('#txtDate').val().trim() != "") {
                    date = $('#txtDate').val().trim();
                }
                if ($('#ddlModel').val().trim() != "") {
                    ModelID = $('#ddlModel').val().trim();
                }
                if ($('#ddlCategory').val().trim() != "") {
                    categoryID = $('#ddlCategory').val().trim();
                }
                if ($('#ddlFaultType').val().trim() != "") {
                    faulttype = $('#ddlFaultType').val().trim();
                }
                if ($('#ddlSubCategory').val().trim() != "") {
                    SubCategoryID = $('#ddlSubCategory').val().trim();
                }
                var data = {
                    Date: date,
                    ModelID: ModelID,
                    CategoryID: categoryID,
                    FaultType: faulttype,
                    SubCategoryID: SubCategoryID,
                }
                console.log(data);
                    $.ajax({
                        data: data,
                        url: '@Url.Action("LoadFaultsData", "DailyMaxFaultAnalysis")',
                        type: 'GET',
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (result) {
                            if (result != null) {
                                LoadedSortData = [];
                                console.log(result);

                                for (var h = 0; h < result.length; h++) {
                                    LoadedSortData.push({
                                        Model: result[h].model,
                                        Category: result[h].categoryName,
                                        FaultType: result[h].faultType,
                                        SubCategory: result[h].subCategoryName,
                                        Quantity: result[h].faultQty,
                                    });
                                }
                                if (result.length != 0) {
                                    GeneratedItemsTable1();
                                    //$('#submit').text('Update');
                                }
                                else {
                                    GeneratedItemsTable1();
                                }
                            }
                            else {

                            }

                        }
                    });
            }


            //function Clear() {
            //    $('#ddlModel').val("00000000-0000-0000-0000-000000000000").change();
            //    $('#ddlCategory').val("").change();
            //    $('#ddlFaultType').val("").change();
            //    $('#ddlSubCategory').val("").change();
            //    $('#txtReason, #txtSample, #txtRemarks, #txtSolutionAndRecommendation, #f_UploadImage').val("");
            //    $("#myUploadedImg").attr("src", "/Banner/default.png");
            //}
            //$('#txtDate').on('change', function () {

            //    if ($('#ddlModel').val().trim() == '') {

            //    }
            //    else {
            //        DropDownChangeData();
            //    }
            //});
            //$('#ddlModel').on('change', function () {
            //    if ($('#txtDate').val().trim() == '') {
            //        alert("Please Select Date First!");
            //        $('#ddlModel').val("");
            //    }
            //    else {
            //        DropDownChangeData();
            //    }
            //});
            function DropDownChangeData2() {
                var date = null;
                var ModelID = null;
                var AnalysisType = null;
                if ($('#ddlAnalysisType').val().trim() != "") {
                    AnalysisType = $('#ddlAnalysisType').val().trim();
                }
                if ($('#txtDate').val().trim() != "") {
                    date = $('#txtDate').val().trim();
                }
                if ($('#ddlModel').val().trim() != "") {
                    ModelID = $('#ddlModel').val().trim();
                }
                var data = {
                    Date: date,
                    ModelID: ModelID,
                    AnalysisType: AnalysisType,
                }
                console.log(data);
                    $.ajax({
                        data: data,
                        url: '@Url.Action("LoadSortedTopResult", "DailyMaxFaultAnalysis")',
                        type: 'GET',
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (result) {
                            if (result != null) {
                                faultsItem = [];
                                console.log(result);

                                for (var h = 0; h < result.length; h++) {
                                    faultsItem.push({
                                        AnalysisType: result[h].analysisType,
                                        PartsModelID: result[h].partsModelID,
                                        Model: result[h].model,
                                        CategoryID: result[h].categoryID,
                                        Category: result[h].category,
                                        SubCategoryID: result[h].subCategoryID,
                                        SubCategory: result[h].subCategory,
                                        Quantity: 0,
                                        ImageUrl: result[h].imageUrl,
                                        Reason: result[h].reason,
                                        Sample: Number(result[h].sample),
                                        Remarks: result[h].remarks,
                                        ProblemSolAndRec: result[h].problemSolAndRec
                                    });
                                }
                                if (result.length != 0) {
                                    GeneratedItemsTable();
                                }
                                console.log(faultsItem);
                            }
                            else {

                            }

                        }
                    });
            }


            //function for show added items in table
            function GeneratedItemsTable1() {
                if (LoadedSortData.length > 0) {
                    var $table = $('<table id="header-fixed" border="0" cellpadding="0" cellspacing="0" class="scroll" style="width: 100%;"/>');
                    $table.append('<thead style = "background-color: #73879c; color: white;"><tr><th>Model</th><th>Category</th><th>Fault Type</th><th>Sub Category</th><th>Quantity</th></tr></thead>');
                    var $tbody = $('<tbody/>');
                    $.each(LoadedSortData, function (i, val) {
                        var $row = $('<tr/>');
                        $row.append($('<td/>').html(val.Model));
                        $row.append($('<td/>').html(val.Category));

                        $row.append($('<td/>').html(val.FaultType));
                        $row.append($('<td/>').html(val.SubCategory));
                        $row.append($('<td/>').html(val.Quantity));
                        $tbody.append($row);
                    });
                    console.log("current", LoadedSortData);
                    $table.append($tbody);
                    $('#LoadedSortData').html($table);
                }
                else {
                    $('#LoadedSortData').html('There is no data to preview...');
                }
            }
            function sendFile(fileName) {
                //Remove(IMGURL);
                if (document.getElementById("f_UploadImage").files.length != 0) {
                    var file = $('#f_UploadImage').get(0).files[0];
                    var formData = new FormData();
                    formData.append('file', file, fileName);

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("Upload_File", "DailyMaxFaultAnalysis")",
                        contentType: false,
                        processData: false,
                        data: formData,
                        async: false,
                        success: function (message) {
                            IMGURL = "";
                            //$("#myUploadedImg").removeAttr("src").attr("src", message);
                            //$("#myUploadedImg").attr("src", message);
                            //$("a").attr("href", message)
                            IMGURL = message;
                        },
                        error: function () {
                            alert("Error!");
                        }
                    });
                }
            }
            function DateFormat(dateparam) {
                const now = new Date(dateparam);
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                return `${month}_${day}_${now.getFullYear()}`;
            }
            function GeneratedItemsTable() {
                if (faultsItem.length > 0) {
                    /*faultsItem.keySort('AnalysisType');*/
                    console.log(faultsItem);
                    var $table = $('<table id="datatable-fixed-header" class="table table-sm table-striped" style="width:100%"/>');
                    $table.append('<thead style = "background-color: #586caa; color: white;"><tr><th>Type</th><th>Model</th><th>Top Faulty Item</th><th>Image</th><th>Fault</th><th>Qty.</th><th>Reson</th><th>Sample</th><th>Remarks</th><th>Solution</th><th></th></tr></thead>');
                    var $tbody = $('<tbody/>');
                    $.each(faultsItem, function (i, val) {
                        var $row = $('<tr/>');
                        $row.append($('<td/>').html(val.AnalysisType));
                        $row.append($('<td/>').html(val.Model));
                        $row.append($('<td/>').html(val.Category));
                        if (val.ImageUrl == "") {
                            $row.append($('<td/>').html("Picture wasn't detected"));
                        }
                        else {
                            var replacedata = val.ImageUrl.replace("/", "'\'");
                            var $img = $('<a style="font-size: large; color:blueviolet;" target="_blank" href = "' + wwwrootpath + replacedata + '"> <i class="fa fa-image"></i> </a>');
                            $row.append($('<td/>').html($img));
                        }
                        $row.append($('<td/>').html(val.SubCategory));
                        $row.append($('<td/>').html(val.Quantity));
                        $row.append($('<td/>').html(val.Reason));
                        $row.append($('<td/>').html(val.Sample));
                        $row.append($('<td/>').html(val.Remarks));
                        $row.append($('<td/>').html(val.ProSolutionAndRemarks));
                        var $remove = $('<a href="#"><i style="font-size: 17px; color:red;" class="fa fa-trash"></i></a>');
                        $remove.click(function (e) {
                            e.preventDefault();
                            faultsItem.splice(i, 1);
                            Remove(val.ImageUrl);
                            GeneratedItemsTable();
                        });
                        $row.append($('<td/>').html($remove));

                        $tbody.append($row);
                    });
                    console.log("current", faultsItem);
                    $table.append($tbody);
                    $('#faultsItem').html($table);
                }
                else {
                    $('#faultsItem').html('');
                }
            }
            function Remove(URL) {
                var data = {
                    ImgPath: URL
                }
                console.log(data);
                    $.ajax({
                        data: data,
                        url: '@Url.Action("FileRemove", "DailyMaxFaultAnalysis")',
                        type: 'GET',
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (result) {
                            return true;
                        }
                    });
            }
            function readURL(li, args) {
                var preview = li.querySelector('.upload-image');
                var file = args.rawFile;
                var reader = new FileReader();
                reader.addEventListener('load', function () { preview.src = reader.result; }, false);
                if (file) {
                    reader.readAsDataURL(file);
                }
            }
            function checkIfObjectExist(faultsItem, Analysis,  text, id) {
                console.log(faultsItem);
                if (faultsItem.length > 0) {
                    for (var i = 0; i < faultsItem.length; i++) {
                        if (faultsItem[i].Category === text && faultsItem[i].CategoryID === id && faultsItem[i].AnalysisType === Analysis) {
                            return true;
                        }
                    }
                }
                else {
                    return false;
                }
            }
            function ConfirmDialog(message) {
                $('<div></div>').appendTo('body')
                    .html('<div><h6>' + message + '?</h6></div>')
                    .dialog({
                        modal: true,
                        title: 'Delete message',
                        zIndex: 10000,
                        autoOpen: true,
                        width: 'auto',
                        resizable: false,
                        buttons: {
                            Yes: function () {
                                // $(obj).removeAttr('onclick');
                                // $(obj).parents('.Parent').remove();

                                $('body').append('<h1>Confirm Dialog Result: <i>Yes</i></h1>');

                                $(this).dialog("close");
                            },
                            No: function () {
                                $('body').append('<h1>Confirm Dialog Result: <i>No</i></h1>');

                                $(this).dialog("close");
                            }
                        },
                        close: function (event, ui) {
                            $(this).remove();
                        }
                    });
            };
            function showpop5(msg, title, SuccessText) {
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "12000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr[SuccessText](msg, title);
                return false;
            }
            Array.prototype.keySort = function (key, desc) {
                this.sort(function (a, b) {
                    var result = desc ? (a[key] < b[key]) : (a[key] > b[key]);
                    return result ? 1 : -1;
                });
                return this;
            }
        });

        function RedirectToPage() {
            window.location.href = '@Url.Action("Index", "DailyMaxFaultAnalysis")';
        }
    </script>
}

<style>
    /*Adding some css for looks good*/
    span.error {
        display: block;
        visibility: hidden;
        color: red;
        font-size: 90%;
    }

    .addbutton {
        display: inline-block;
        padding: 0px 16px;
        font-size: 19px;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        outline: none;
        color: #fff;
        background-color: #4CAF50;
        border: none;
        border-radius: 15px;
        margin-top: 15px;
    }

        .addbutton:hover {
            background-color: #3e8e41
        }

        .addbutton:active {
            background-color: #3e8e41;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
        }
    /*css for table*/
    /*.container td {
        vertical-align: top;
    }

    .tablecontainer table {
        width: 100%;
        border-collapse: collapse;
        border-top: 1px solid #BFAEAE;
        border-right: 1px solid #BFAEAE;
    }

    .tablecontainer th {
        border-bottom: 2px solid #BFAEAE !important;
    }*/

    .tablecontainer th, .tablecontainer td {
        text-align: center;
    }

    /*.ui-widget {
        font-size: 12px !important;
    }*/
    .ui-autocomplete {
        max-height: 200px;
        max-width: 700px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .ui-autocomplete {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        float: left;
        display: none;
        min-width: 160px;
        padding: 4px 0;
        margin: 0 0 10px 25px;
        list-style: none;
        background-color: #ffffff;
        border-color: #ccc;
        border-color: rgba(0, 0, 0, 0.2);
        border-style: solid;
        border-width: 1px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -webkit-background-clip: padding-box;
        -moz-background-clip: padding;
        background-clip: padding-box;
        *border-right-width: 2px;
        *border-bottom-width: 2px;
    }

    .ui-menu-item > a.ui-corner-all {
        display: block;
        padding: 3px 15px;
        clear: both;
        font-weight: normal;
        line-height: 18px;
        color: #555555;
        white-space: nowrap;
        text-decoration: none;
    }

    .ui-state-hover, .ui-state-active {
        color: #ffffff;
        text-decoration: none;
        background-color: #0088cc;
        border-radius: 0px;
        -webkit-border-radius: 0px;
        -moz-border-radius: 0px;
        background-image: none;
    }

    .bg-white {
        background: #fff !important;
        border: 1px solid #fff !important;
        color: #19416c;
    }

    .select2-container--default .select2-search--dropdown .select2-search__field {
        border: 1px solid #32a73e;
        border-radius: 6px;
    }

    /*Scroll Css*/

    div.wrapper {
        padding: 20px;
    }

    table.scroll thead tr:after {
        content: '';
        overflow-y: scroll;
        visibility: hidden;
    }

    table.scroll thead th {
        flex: 1 auto;
        display: block;
        color: #fff;
    }

    table.scroll tbody {
        display: block;
        width: 100%;
        overflow-y: auto;
        height: auto;
        max-height: 200px;
    }

        table.scroll thead tr,
        table.scroll tbody tr {
            display: flex;
        }

            table.scroll tbody tr td {
                flex: 1 auto;
            }

            table.scroll thead tr th,
            table.scroll tbody tr td {
                width: 25%;
                padding: 5px;
                border-top: 1px solid rgba(0,0,0,0.3);
                text-align: center;
            }
</style>